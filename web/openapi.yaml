openapi: 3.0.0
info:
  title: EcoCampus+ Integrated API
  version: 1.0.0
  description: |
    EcoCampus+ í”Œë«í¼ì˜ í†µí•© API ëª…ì„¸ì„œì…ë‹ˆë‹¤.
    IoT ì„¼ì„œ ë°ì´í„° ìˆ˜ì§‘ë¶€í„° AI ë¶„ì„, í•™ìƒ ë³´ìƒ, ê´€ë¦¬ì ëª¨ë‹ˆí„°ë§ê¹Œì§€ì˜ ë°ì´í„° íë¦„ì„ ì •ì˜í•©ë‹ˆë‹¤.

servers:
  - url: http://localhost:8080/api/v1
    description: Local Development Server

paths:
  # [IoT Layer]
  /sensors/rssi-logs:
    post:
      summary: "ì—£ì§€ ì •ì œ ë¹„ì½˜ ë°ì´í„° ìˆ˜ì§‘"
      operationId: postRssiLogs
      tags:
        - IoT Layer
      description: |
        ë¼ì¦ˆë² ë¦¬íŒŒì´ì—ì„œ ê°ì§€ ë° ì •ì œëœ ë¹„ì½˜ ì‹ í˜¸ ë°ì´í„°ë¥¼ ì„œë²„ë¡œ ì „ì†¡í•©ë‹ˆë‹¤.
        1ì°¨ ì •ì œëœ ë°ì´í„°(Sample Count, Stdev í¬í•¨)ë¥¼ ë°›ì•„ AI ëª¨ë¸ì˜ ì‹ ë¢°ë„ë¥¼ í™•ë³´í•©ë‹ˆë‹¤.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [space_id, beacon_uuid, rssi_value, sample_count, timestamp]
              properties:
                space_id:
                  type: string
                  description: "ë¹„ì½˜ì´ ì„¤ì¹˜ëœ ê³µê°„ ID (ìœ„ì¹˜ ë¹„ì‹ë³„í™”)"
                beacon_uuid:
                  type: string
                  description: "ë¹„ì½˜ ê³ ìœ  ì‹ë³„ì"
                rssi_value:
                  type: number
                  format: float
                  description: "ìœˆë„ìš° í‰ê·  RSSI (dBm)"
                sample_count:
                  type: integer
                  description: "í‰ê·  ì‚°ì¶œì— ì‚¬ìš©ëœ ìƒ˜í”Œ ìˆ˜"
                signal_strength_stdev:
                  type: number
                  format: float
                  description: "ì‹ í˜¸ ê°•ë„ í‘œì¤€í¸ì°¨ (ë°ì´í„° ì‹ ë¢°ë„ ì§€í‘œ)"
                timestamp:
                  type: string
                  format: date-time
                  description: "ISO 8601 í˜•ì‹ ë°ì´í„° ìˆ˜ì§‘ ì‹œê°"
      responses:
        '201':
          description: "ë°ì´í„° ìˆ˜ì‹  ë° ê¸°ë¡ ì™„ë£Œ"

  # [AI Layer]
  /ai/occupancy-status:
    get:
      summary: "ê³µê°„ ì ìœ  íŒë³„ ê²°ê³¼ ì¡°íšŒ"
      tags: [AI Layer]
      description: ML ëª¨ë“ˆì´ íŒë³„í•œ íŠ¹ì • ê³µê°„ì˜ í˜„ì¬ ì ìœ  ìƒíƒœ(Occupied/Vacant)ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
      parameters:
        - name: space_id
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIResult'

  /ai/predictions:
    get:
      summary: "ì—ë„ˆì§€ ì‚¬ìš© ì˜ˆì¸¡ ë° ì´ìƒ íƒì§€ ë°ì´í„° ì¡°íšŒ"
      tags: [AI Layer]
      description: DL ëª¨ë“ˆì´ ë¶„ì„í•œ í–¥í›„ ì—ë„ˆì§€ ì‚¬ìš© ì˜ˆì¸¡ ë° ì´ìƒ ì‚¬ìš©(íŒ¨í„´ ì´íƒˆ) ì—¬ë¶€ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    space_id: { type: string }
                    predicted_load: { type: string, enum: [High, Medium, Low] }
                    is_anomaly: { type: boolean }
                    insight_summary: { type: string }
              example:
                - space_id: "RM-101"
                  predicted_load: "High"
                  is_anomaly: true
                  insight_summary: "í‰ì†Œë³´ë‹¤ ì—ë„ˆì§€ ë‚­ë¹„ ìœ„í—˜ì´ ì»¸ë˜ êµ¬ê°„ì…ë‹ˆë‹¤."

  # [Student App]
  /missions/recommendations:
    get:
      summary: "AI ê¸°ë°˜ ì¶”ì²œ ë¯¸ì…˜ ëª©ë¡ ì¡°íšŒ"
      tags: [Student App]
      description: AI ê¸°ë°˜ ë§ì¶¤í˜• ë¯¸ì…˜ ëª©ë¡ì„ ì¡°íšŒí•˜ë©°, ê³ ë¶€í•˜ ì‹œê°„ëŒ€ ë³´ë„ˆìŠ¤ ì •ë³´ê°€ í¬í•¨ë©ë‹ˆë‹¤.
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Mission'

  /missions/{id}/complete:
    post:
      summary: "ë¯¸ì…˜ ì™„ë£Œ ë° ë³´ìƒ ì²˜ë¦¬"
      tags: [Student App]
      description: ë¯¸ì…˜ ìˆ˜í–‰ ê²°ê³¼ë¥¼ ë°±ì—”ë“œ ê²€ì¦ ë¡œì§ê³¼ ëŒ€ì¡°í•˜ì—¬ ì™„ë£Œ ì²˜ë¦¬í•˜ê³  ë³´ìƒì„ ì§€ê¸‰í•©ë‹ˆë‹¤.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserReward'

  /feedback/natural-language:
    get:
      summary: "LLM í–‰ë™ ì˜ë¯¸ í”¼ë“œë°± ë©”ì‹œì§€ ì¡°íšŒ"
      tags: [Student App]
      description: LLMì´ ìƒì„±í•œ 'í–‰ë™ ì˜ë¯¸ ê°•í™”' í”¼ë“œë°±ì„ ì¡°íšŒí•©ë‹ˆë‹¤.
      responses:
        '200':
          content:
            application/json:
              schema:
                type: object
                properties:
                  feedback_message: { type: string }
              example:
                feedback_message: "ì˜¤ëŠ˜ ê·€í•˜ì˜ ì ˆì•½ í–‰ë™ ë•ë¶„ì— íƒ„ì†Œ ë°°ì¶œëŸ‰ì´ 20% ê°ì†Œí–ˆìŠµë‹ˆë‹¤. ìº í¼ìŠ¤ì˜ ì˜ì›…ì´ ë˜ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ğŸŒ±"

  # [Admin Web]
  /admin/dashboard/summary:
    get:
      summary: "ì „ì²´ ìš´ì˜ í˜„í™© ìš”ì•½ ë¦¬í¬íŠ¸"
      tags: [Admin Web]
      description: ì‹¤ì‹œê°„ ì ìœ  í˜„í™©ê³¼ AI ê¸°ë°˜ ìš”ì•½ ë¦¬í¬íŠ¸ë¥¼ í†µí•© ì¡°íšŒí•©ë‹ˆë‹¤.
      responses:
        '200':
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_occupied: { type: integer }
                  anomalies_detected: { type: integer }
                  llm_insight_report: { type: string }

  /admin/spaces/{id}/thresholds:
    patch:
      summary: "ê³µê°„ ì ìœ  íŒë³„ ì„ê³„ê°’ ì¡°ì • (Model Drift ëŒ€ì‘)"
      tags: [Admin Web]
      description: ê´€ë¦¬ìê°€ í˜„ì¥ ìƒí™©ì— ë§ì¶° ì„ê³„ê°’ì„ ë¯¸ì„¸ ì¡°ì •í•˜ëŠ” 'Feedback Loop' ì—­í• ì„ í•©ë‹ˆë‹¤.
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [new_threshold, adjustment_reason]
              properties:
                new_threshold: { type: number, format: float }
                adjustment_reason: { type: string }
      responses:
        '200':
          description: "ì„ê³„ê°’ ë°˜ì˜ ì™„ë£Œ"

components:
  schemas:
    SensorData:
      type: object
      properties:
        space_id: { type: string, description: "ê³µê°„ ì‹ë³„ì" }
        rssi_avg: { type: number, format: float, description: "ì •ì œëœ RSSI í‰ê· " }
        timestamp: { type: string, format: date-time }

    Mission:
      type: object
      properties:
        mission_id: { type: string }
        title: { type: string }
        bonus_points: { type: integer, example: 20 }
        recommendation_reason: { type: string, description: "AIê°€ ë¶„ì„í•œ ì¶”ì²œ ì‚¬ìœ " }
        is_high_load_window: { type: boolean }

    AIResult:
      type: object
      properties:
        status: { type: string, enum: [Occupied, Vacant] }
        confidence: { type: number, format: float }
        insight_text: { type: string }

    UserReward:
      type: object
      properties:
        user_id_hash: { type: string }
        total_points: { type: integer }
        character_level: { type: integer }
        earned_points: { type: integer }

    SpaceInfo:
      type: object
      properties:
        space_id: { type: string }
        threshold_value: { type: number, format: float }
        is_active: { type: boolean }
